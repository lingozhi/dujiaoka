# 配置重启指南

## 需要重启的配置项

修改以下配置后，需要重启服务才能生效：

- ✉️ **邮件服务配置** (SMTP设置)
- 📢 **通知配置** (Server酱、Telegram等)
- 🔧 **队列配置** (Redis连接等)
- 🌐 **第三方API配置** (支付网关等)

## Railway 平台重启方法

### 方法1：通过 Railway 控制台重启（推荐）

1. 访问 [Railway Dashboard](https://railway.app/dashboard)
2. 选择你的项目
3. 点击服务名称（dujiaoka）
4. 点击右上角 **"⋮"** 菜单
5. 选择 **"Restart"**
6. 等待 1-2 分钟完成重启

**优点**：
- ✅ 简单快速
- ✅ 不影响持久化数据
- ✅ 安全可靠

### 方法2：使用 Railway CLI

如果已安装 Railway CLI：

```bash
railway service restart
```

### 方法3：触发重新部署

```bash
# 创建空提交触发部署
git commit --allow-empty -m "Reload configuration"
git push origin railway-deployment
```

## 不需要重启的配置

以下配置修改后**立即生效**，无需重启：

- ✅ 站点基本信息（名称、描述）
- ✅ 商品配置
- ✅ 订单设置
- ✅ 界面显示设置
- ✅ 大部分管理后台配置

## 配置热加载（推荐）

对于频繁修改的配置，可以使用以下命令清除缓存而无需重启：

```bash
# 在本地或通过 Railway CLI 执行
php artisan config:reload
```

这会清除并重建配置缓存，但**不会重启队列工作进程**。

## 常见问题

### Q: 修改了邮件配置，但测试邮件发送失败？
A: 需要重启服务，邮件配置才会重新加载。

### Q: 重启会影响正在处理的订单吗？
A: 不会。数据都保存在数据库中，重启只是重新加载配置。

### Q: 多久可以完成重启？
A: 通常 1-2 分钟，Railway 会自动处理零停机重启。

### Q: 重启会丢失数据吗？
A: 不会。所有数据都保存在持久化存储（/data目录）和数据库中。

## 最佳实践

1. **批量修改配置**：一次性修改多个配置，然后统一重启
2. **测试环境**：重要配置修改前，先在测试环境验证
3. **低峰期操作**：建议在访问量较低时重启
4. **记录变更**：重要配置修改建议做好记录

## 技术说明

Railway 使用容器化部署，重启实际上是：
1. 创建新的容器实例
2. 使用最新配置启动服务
3. 切换流量到新容器
4. 关闭旧容器

整个过程对用户几乎无感知。
